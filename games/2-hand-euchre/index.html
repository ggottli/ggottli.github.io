<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Two-Handed Euchre</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
            rel="stylesheet"
        />
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            
            body {
                font-family: "Poppins", -apple-system, BlinkMacSystemFont, sans-serif;
                background: #0d2818;
                background-image: 
                    radial-gradient(ellipse at center, #1a3d2a 0%, #0d2818 50%, #06140d 100%);
                color: #f8f9fa;
                height: 100vh;
                overflow: auto;
                display: flex;
                align-items: flex-start;
                justify-content: center;
                position: relative;
                padding: 1rem 0;
            }
            
            body::before {
                content: '';
                position: absolute;
                inset: 0;
                background: 
                    radial-gradient(circle at 20% 80%, rgba(0,0,0,0.3) 0%, transparent 50%),
                    radial-gradient(circle at 80% 20%, rgba(0,0,0,0.3) 0%, transparent 50%),
                    radial-gradient(circle at 40% 40%, rgba(255,255,255,0.02) 0%, transparent 50%);
                pointer-events: none;
            }
            
            .poker-table {
                position: fixed;
                inset: 0;
                background: radial-gradient(ellipse at center, #2d5a3d 0%, #1a3d2a 70%, #0d2818 100%);
                box-shadow: 
                    inset 0 0 100px rgba(0,0,0,0.5),
                    0 0 50px rgba(0,0,0,0.8);
                z-index: 1;
            }
            
            @media (min-width: 768px) {
                .poker-table {
                    inset: 5%;
                    border-radius: 50%;
                    border: 8px solid #4a2c17;
                }
            }
            
            .poker-table::before {
                content: '';
                position: absolute;
                inset: 20px;
                border-radius: 50%;
                border: 2px solid rgba(255,255,255,0.1);
            }
            
            .game-container {
                width: 100%;
                max-width: 1400px;
                min-height: 100vh;
                padding: 1rem;
                display: flex;
                flex-direction: column;
                position: relative;
                z-index: 10;
            }
            
            @media (min-width: 768px) {
                .game-container {
                    height: 100vh;
                    max-height: 900px;
                    justify-content: center;
                }
            }
            
            .header {
                background: linear-gradient(135deg, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.6) 100%);
                backdrop-filter: blur(10px);
                border-radius: 12px;
                padding: 0.75rem 1rem;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
                margin-bottom: 0.75rem;
                border: 1px solid rgba(255,255,255,0.1);
            }
            
            @media (min-width: 768px) {
                .header {
                    padding: 1rem 1.5rem;
                    margin-bottom: 1rem;
                }
            }
            
            .card {
                width: 45px;
                height: 65px;
                border-radius: 6px;
                border: 1px solid #333;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                font-weight: 600;
                position: relative;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                user-select: none;
                background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
                box-shadow: 
                    0 2px 4px rgba(0, 0, 0, 0.3),
                    0 8px 16px rgba(0, 0, 0, 0.2);
            }
            
            @media (min-width: 768px) {
                .card {
                    width: 55px;
                    height: 80px;
                }
            }
            
            @media (min-width: 1024px) {
                .card {
                    width: 70px;
                    height: 100px;
                }
            }
            
            .card.playable {
                cursor: pointer;
            }
            
            .card.playable:hover {
                transform: translateY(-12px) scale(1.08);
                box-shadow: 
                    0 8px 25px rgba(255, 215, 0, 0.4),
                    0 12px 20px rgba(0, 0, 0, 0.4);
                border-color: #ffd700;
            }
            
            .card.face-down {
                background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
                border-color: #ffd700;
            }
            
            .card.face-down::after {
                content: '';
                position: absolute;
                inset: 6px;
                border: 1px solid rgba(255, 215, 0, 0.3);
                border-radius: 3px;
                background: repeating-linear-gradient(
                    45deg,
                    transparent,
                    transparent 3px,
                    rgba(255, 215, 0, 0.1) 3px,
                    rgba(255, 215, 0, 0.1) 6px
                );
            }
            
            .card.red {
                color: #dc3545;
            }
            
            .card.black {
                color: #212529;
            }
            
            .card-rank {
                font-size: 1.1rem;
                line-height: 1;
                font-weight: 700;
            }
            
            .card-suit {
                font-size: 0.8rem;
                margin-top: 2px;
            }

            @media (min-width: 768px) {
                .card-rank {
                    font-size: 1.4rem;
                }
                .card-suit {
                    font-size: 1rem;
                }
            }
            
            @media (min-width: 1024px) {
                .card-rank {
                    font-size: 1.8rem;
                }
                .card-suit {
                    font-size: 1.3rem;
                }
            }

            .game-area {
                flex: 1;
                display: flex;
                flex-direction: column;
                gap: 0.75rem;
                min-height: 0;
            }
            
            @media (min-width: 768px) {
                .game-area {
                    gap: 1rem;
                }
            }
            
            .player-section {
                background: linear-gradient(135deg, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.5) 100%);
                backdrop-filter: blur(8px);
                border-radius: 12px;
                padding: 0.75rem;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
                border: 1px solid rgba(255,215,0,0.2);
            }
            
            @media (min-width: 768px) {
                .player-section {
                    padding: 1rem;
                }
            }
            
            .player-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 0.5rem;
                padding: 0 0.5rem;
            }
            
            @media (min-width: 768px) {
                .player-header {
                    margin-bottom: 0.75rem;
                }
            }
            
            .player-name {
                font-weight: 600;
                color: #ffd700;
                font-size: 1rem;
                text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            }
            
            @media (min-width: 768px) {
                .player-name {
                    font-size: 1.1rem;
                }
            }
            
            .trick-count {
                background: linear-gradient(135deg, #ffd700 0%, #ffb347 100%);
                color: #000;
                padding: 0.2rem 0.6rem;
                border-radius: 20px;
                font-size: 0.75rem;
                font-weight: 600;
                box-shadow: 0 2px 8px rgba(255, 215, 0, 0.3);
            }
            
            @media (min-width: 768px) {
                .trick-count {
                    padding: 0.3rem 0.8rem;
                    font-size: 0.875rem;
                }
            }
            
            .cards-container {
                display: flex;
                justify-content: center;
                gap: 0.3rem;
                flex-wrap: wrap;
            }
            
            @media (min-width: 768px) {
                .cards-container {
                    gap: 0.4rem;
                }
            }
            
            .table-cards {
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                gap: 0.3rem;
                margin-bottom: 0.5rem;
                justify-items: center;
            }
            
            @media (min-width: 768px) {
                .table-cards {
                    gap: 0.4rem;
                    margin-bottom: 0.75rem;
                }
            }
            
            .table-card-slot {
                position: relative;
                width: 45px;
                height: 65px;
                margin: 0 auto;
            }
            
            @media (min-width: 768px) {
                .table-card-slot {
                    width: 55px;
                    height: 80px;
                }
            }
            
            @media (min-width: 1024px) {
                .table-card-slot {
                    width: 70px;
                    height: 100px;
                }
            }
            
            .trick-area {
                background: radial-gradient(ellipse at center, rgba(255,215,0,0.1) 0%, rgba(0,0,0,0.3) 100%);
                backdrop-filter: blur(8px);
                border-radius: 16px;
                padding: 1rem;
                display: flex;
                justify-content: center;
                align-items: center;
                gap: 2rem;
                min-height: 100px;
                box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.3);
                border: 2px solid rgba(255,215,0,0.2);
            }
            
            @media (min-width: 768px) {
                .trick-area {
                    padding: 1.5rem;
                    gap: 3rem;
                    min-height: 120px;
                }
            }
            
            .message-box {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, rgba(0,0,0,0.95) 0%, rgba(26,61,42,0.95) 100%);
                border: 2px solid #ffd700;
                padding: 2rem;
                border-radius: 16px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
                z-index: 50;
                text-align: center;
                width: 90%;
                max-width: 450px;
            }
            
            .trump-btn {
                padding: 0.75rem 1.5rem;
                border-radius: 8px;
                font-weight: 600;
                transition: all 0.2s ease;
                border: none;
                cursor: pointer;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }
            
            .trump-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
            }
            
            .trump-btn:active {
                transform: translateY(0);
            }

            .trick-card-enter {
                animation: card-fly-in 0.5s ease-out forwards;
            }
            
            @keyframes card-fly-in {
                0% {
                    transform: scale(0.6) translateY(-30px) rotate(5deg);
                    opacity: 0;
                }
                50% {
                    transform: scale(1.1) translateY(-10px) rotate(-2deg);
                    opacity: 0.8;
                }
                100% {
                    transform: scale(1) translateY(0) rotate(0deg);
                    opacity: 1;
                }
            }

            .fly-off-player {
                animation: fly-off-player 0.8s ease-in forwards;
            }
            
            @keyframes fly-off-player {
                0% {
                    transform: scale(1) translateY(0) rotate(0deg);
                    opacity: 1;
                }
                50% {
                    transform: scale(1.2) translateY(80px) rotate(10deg);
                    opacity: 0.7;
                }
                100% {
                    transform: translateY(200px) scale(0.3) rotate(25deg);
                    opacity: 0;
                }
            }

            .fly-off-bot {
                animation: fly-off-bot 0.8s ease-in forwards;
            }
            
            @keyframes fly-off-bot {
                0% {
                    transform: scale(1) translateY(0) rotate(0deg);
                    opacity: 1;
                }
                50% {
                    transform: scale(1.2) translateY(-80px) rotate(-10deg);
                    opacity: 0.7;
                }
                100% {
                    transform: translateY(-200px) scale(0.3) rotate(-25deg);
                    opacity: 0;
                }
            }
        </style>
    </head>
    <body>
        <div class="poker-table"></div>
        <div id="game-container" class="game-container">
            <!-- Header -->
            <div class="header">
                <div class="flex flex-col sm:flex-row justify-between items-center gap-3">
                    <div class="flex items-center space-x-2 sm:space-x-4">
                        <h1 class="text-lg sm:text-xl font-bold text-yellow-400">Two-Handed Euchre</h1>
                        <button
                            id="rules-btn"
                            class="text-xs sm:text-sm bg-yellow-600 hover:bg-yellow-700 text-white font-medium py-1 px-2 sm:px-3 rounded-lg transition-colors"
                        >
                            Rules
                        </button>
                        <select
                            id="difficulty-select"
                            class="text-xs sm:text-sm bg-yellow-600 text-white font-medium py-1 px-2 sm:px-3 rounded-lg border border-yellow-500"
                        >
                            <option value="easy">Easy</option>
                            <option value="medium" selected>Medium</option>
                            <option value="hard">Hard</option>
                        </select>
                    </div>
                    
                    <div class="flex items-center space-x-3 sm:space-x-6">
                        <div id="trump-display" class="text-center">
                            <div class="text-xs sm:text-sm font-medium text-yellow-300">Trump</div>
                            <div id="trump-suit" class="text-xl sm:text-2xl font-bold text-yellow-400">-</div>
                        </div>
                        
                        <div class="flex space-x-3 sm:space-x-6">
                            <div class="text-center">
                                <div class="text-xs sm:text-sm font-medium text-yellow-300">Player</div>
                                <div id="player-score" class="text-lg sm:text-xl font-bold text-yellow-400">0</div>
                            </div>
                            <div class="text-center">
                                <div class="text-xs sm:text-sm font-medium text-yellow-300">Bot</div>
                                <div id="bot-score" class="text-lg sm:text-xl font-bold text-yellow-400">0</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Game Area -->
            <div class="game-area">
                <!-- Bot's Area -->
                <div class="player-section">
                    <div class="player-header">
                        <div class="player-name">Bot</div>
                        <div class="trick-count"><span id="bot-trick-count">0</span> tricks</div>
                    </div>
                    <div id="bot-table-area" class="table-cards"></div>
                    <div id="bot-in-hand-area" class="cards-container"></div>
                </div>

                <!-- Trick Area -->
                <div id="trick-area" class="trick-area">
                    <div id="bot-trick-card" class="card hidden"></div>
                    <div id="player-trick-card" class="card hidden"></div>
                </div>

                <!-- Player's Area -->
                <div class="player-section">
                    <div class="player-header">
                        <div class="player-name">Player</div>
                        <div class="trick-count"><span id="player-trick-count">0</span> tricks</div>
                    </div>
                    <div id="player-table-area" class="table-cards"></div>
                    <div id="player-in-hand-area" class="cards-container"></div>
                </div>
            </div>
        </div>

        <!-- Message Box / Modal -->
        <div id="message-box" class="hidden message-box">
            <h3 id="message-title" class="text-2xl font-bold mb-4"></h3>
            <div id="message-text" class="mb-6"></div>
            <div
                id="message-buttons"
                class="flex justify-center flex-wrap gap-2"
            ></div>
        </div>

        <script>
            // --- DOM Elements ---
            const playerScoreEl = document.getElementById("player-score");
            const botScoreEl = document.getElementById("bot-score");
            const playerTrickCountEl =
                document.getElementById("player-trick-count");
            const botTrickCountEl = document.getElementById("bot-trick-count");
            const botTableArea = document.getElementById("bot-table-area");
            const playerTableArea =
                document.getElementById("player-table-area");
            const playerInHandArea = document.getElementById(
                "player-in-hand-area",
            );
            const botInHandArea = document.getElementById("bot-in-hand-area");
            const playerTrickCardEl =
                document.getElementById("player-trick-card");
            const botTrickCardEl = document.getElementById("bot-trick-card");
            const messageBox = document.getElementById("message-box");
            const messageTitle = document.getElementById("message-title");
            const messageText = document.getElementById("message-text");
            const messageButtons = document.getElementById("message-buttons");
            const trumpSuitEl = document.getElementById("trump-suit");
            const rulesBtn = document.getElementById("rules-btn");
            const difficultySelect = document.getElementById("difficulty-select");

            // --- Game State ---
            let playerScore = 0,
                botScore = 0,
                playerTricks = 0,
                botTricks = 0;
            let deck = [],
                playerHand,
                botHand;
            let trumpSuit = "",
                trumpCaller = "",
                currentTurn = "",
                trickWinner = "";
            let leadCard = null,
                trickCards = [];
            let isPlayerDealer = false;
            let handOver = false;
            let botDifficulty = "medium"; // easy, medium, hard

            // --- Card Definitions ---
            const suits = { S: "♠", H: "♥", D: "♦", C: "♣" };
            const ranks = ["9", "10", "J", "Q", "K", "A"];
            const suitColors = { S: "black", H: "red", D: "red", C: "black" };
            const sameColorSuits = { S: "C", C: "S", H: "D", D: "H" };

            // --- Game Logic ---

            function createDeck() {
                deck = [];
                for (const s in suits)
                    for (const r of ranks) deck.push({ rank: r, suit: s });
            }
            function shuffleDeck() {
                for (let i = deck.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [deck[i], deck[j]] = [deck[j], deck[i]];
                }
            }

            function dealCards() {
                playerHand = {
                    inHand: [],
                    tableFaceUp: [...Array(4)],
                    tableFaceDown: [],
                };
                botHand = {
                    inHand: [],
                    tableFaceUp: [...Array(4)],
                    tableFaceDown: [],
                };
                for (let i = 0; i < 4; i++) {
                    playerHand.tableFaceDown.push(deck.pop());
                    botHand.tableFaceDown.push(deck.pop());
                }
                for (let i = 0; i < 4; i++) {
                    playerHand.tableFaceUp[i] = deck.pop();
                    botHand.tableFaceUp[i] = deck.pop();
                }
                for (let i = 0; i < 4; i++) {
                    playerHand.inHand.push(deck.pop());
                    botHand.inHand.push(deck.pop());
                }
            }

            function createCardElement(card, id) {
                const el = document.createElement("div");
                if (card) {
                    el.className = `card ${suitColors[card.suit]}`;
                    el.innerHTML = `<span class="card-rank">${card.rank}</span><span class="card-suit">${suits[card.suit]}</span>`;
                    el.dataset.rank = card.rank;
                    el.dataset.suit = card.suit;
                    if (id) el.id = id;
                } else {
                    el.className = "card face-down";
                }
                return el;
            }

            function renderHands() {
                playerTableArea.innerHTML = "";
                botTableArea.innerHTML = "";
                playerInHandArea.innerHTML = "";
                botInHandArea.innerHTML = "";

                for (let i = 0; i < 4; i++) {
                    const pContainer = document.createElement("div");
                    pContainer.className = "table-card-slot";
                    if (
                        playerHand.tableFaceDown[i] ||
                        playerHand.tableFaceUp[i]
                    ) {
                        const fdEl = createCardElement(null);
                        pContainer.appendChild(fdEl);
                        if (playerHand.tableFaceUp[i]) {
                            const fuEl = createCardElement(
                                playerHand.tableFaceUp[i],
                                `player-fu-${i}`,
                            );
                            fuEl.style.position = "absolute";
                            fuEl.style.top = "0";
                            fuEl.style.left = "0";
                            if (playerHand.tableFaceDown[i]) {
                                fuEl.style.top = "-2px";
                                fuEl.style.left = "-2px";
                            }
                            pContainer.appendChild(fuEl);
                        }
                    }
                    playerTableArea.appendChild(pContainer);

                    const bContainer = document.createElement("div");
                    bContainer.className = "table-card-slot";
                    if (botHand.tableFaceDown[i] || botHand.tableFaceUp[i]) {
                        const fdEl = createCardElement(null);
                        bContainer.appendChild(fdEl);
                        if (botHand.tableFaceUp[i]) {
                            const fuEl = createCardElement(
                                botHand.tableFaceUp[i],
                                `bot-fu-${i}`,
                            );
                            fuEl.style.position = "absolute";
                            fuEl.style.top = "0";
                            fuEl.style.left = "0";
                            if (botHand.tableFaceDown[i]) {
                                fuEl.style.top = "-2px";
                                fuEl.style.left = "-2px";
                            }
                            bContainer.appendChild(fuEl);
                        }
                    }
                    botTableArea.appendChild(bContainer);
                }

                playerHand.inHand.forEach((card, i) => {
                    if (card)
                        playerInHandArea.appendChild(
                            createCardElement(card, `player-inhand-${i}`),
                        );
                });

                const botInHandCount = botHand.inHand.filter((c) => c).length;
                for (let i = 0; i < botInHandCount; i++) {
                    botInHandArea.appendChild(createCardElement(null));
                }

                updatePlayableCards();
            }

            function showMessage(title, text, buttons) {
                messageTitle.textContent = title;
                messageText.innerHTML = text;
                messageButtons.innerHTML = "";
                buttons.forEach((btn) => {
                    const buttonEl = document.createElement("button");
                    buttonEl.textContent = btn.text;
                    buttonEl.className = btn.class;
                    buttonEl.onclick = () => {
                        messageBox.classList.add("hidden");
                        btn.callback();
                    };
                    messageButtons.appendChild(buttonEl);
                });
                messageBox.classList.remove("hidden");
            }

            function showRules() {
                const rulesTitle = "Two-Handed Euchre Rules";
                const rulesText = `
                <div class="text-left text-xs sm:text-sm space-y-2">
                    <p><strong>Objective:</strong> Be the first player to score 31 points.</p>
                    <p><strong>Cards:</strong> Uses a 24-card deck (9, 10, J, Q, K, A of all suits).</p>
                    <p><strong>The Bowers:</strong> The Jack of the trump suit is the 'Right Bower' (highest trump). The other Jack of the same color is the 'Left Bower' (2nd highest trump) and is considered part of the trump suit.</p>
                    <p><strong>Dealing:</strong> Each player gets 4 cards face-down, 4 face-up on top, and 4 in their hand.</p>
                    <p><strong>Trump:</strong> The non-dealer chooses trump or passes. If they pass, the dealer MUST choose trump.</p>
                    <p><strong>Playing:</strong> You can play any face-up card or any card from your hand. You must follow the lead suit if possible. When a face-up card from the table is played, the card underneath is flipped over.</p>
                    <p><strong>Scoring:</strong> The player who chose trump must win at least 7 of the 12 tricks. If they succeed, both players get 1 point per trick won. If they fail, their opponent gets 12 points.</p>
                </div>
            `;
                showMessage(rulesTitle, rulesText, [
                    {
                        text: "Close",
                        class: "trump-btn bg-gray-700 hover:bg-gray-600 text-white",
                        callback: () => {},
                    },
                ]);
            }

            function beginTrumpSelection() {
                const chooser = isPlayerDealer ? "bot" : "player";
                if (chooser === "player") promptPlayerToChooseTrump();
                else setTimeout(botDecidesTrumpOrPass, 800);
            }

            function promptPlayerToChooseTrump() {
                const buttons = Object.keys(suits).map((s) => ({
                    text: suits[s],
                    class: `trump-btn bg-blue-700 hover:bg-blue-600 text-white`,
                    callback: () => setTrump(s, "player"),
                }));
                buttons.push({
                    text: "Pass",
                    class: "trump-btn bg-red-700 hover:bg-red-600 text-white",
                    callback: () => {
                        setTimeout(botChoosesTrump, 800);
                    },
                });
                showMessage(
                    "Choose Trump or Pass",
                    "You have the first option to select the trump suit.",
                    buttons,
                );
            }

            function promptPlayerToChooseTrumpMandatory() {
                const buttons = Object.keys(suits).map((s) => ({
                    text: suits[s],
                    class: `trump-btn bg-blue-700 hover:bg-blue-600 text-white`,
                    callback: () => setTrump(s, "player"),
                }));
                showMessage(
                    "You Must Choose Trump",
                    "The bot passed. You must select the trump suit.",
                    buttons,
                );
            }

            function evaluateHandStrength(suit) {
                const allCards = [...botHand.inHand, ...botHand.tableFaceUp].filter(c => c);
                let strength = 0;
                const leftBowerSuit = sameColorSuits[suit];
                
                allCards.forEach(card => {
                    if (card.suit === suit) {
                        if (card.rank === 'J') strength += 8; // Right bower
                        else if (card.rank === 'A') strength += 5;
                        else if (card.rank === 'K') strength += 3;
                        else if (card.rank === 'Q') strength += 2;
                        else strength += 1; // 10, 9
                    } else if (card.suit === leftBowerSuit && card.rank === 'J') {
                        strength += 7; // Left bower
                    } else if (card.rank === 'A') {
                        strength += 2; // Off-suit aces have some value
                    }
                });
                
                return strength;
            }



            function botDecidesTrumpOrPass() {
                setTimeout(() => {
                    const suitStrengths = {};
                    Object.keys(suits).forEach(suit => {
                        suitStrengths[suit] = evaluateHandStrength(suit);
                    });
                    
                    const bestSuit = Object.keys(suitStrengths).reduce((a, b) =>
                        suitStrengths[a] > suitStrengths[b] ? a : b,
                    );
                    
                    let minStrength = isPlayerDealer ? 10 : 12;
                    if (botDifficulty === "easy") minStrength -= 2;
                    else if (botDifficulty === "hard") minStrength += 2;
                    
                    if (suitStrengths[bestSuit] >= minStrength) {
                        setTrump(bestSuit, "bot");
                    } else {
                        showMessage(
                            "Bot Passes",
                            "The bot passes the choice to you.",
                            [
                        {
                            text: "OK",
                            class: "trump-btn bg-blue-700 hover:bg-blue-600 text-white",
                            callback: promptPlayerToChooseTrumpMandatory,
                        },
                            ],
                        );
                    }
                }, 800);
            }

            function botChoosesTrump() {
                setTimeout(() => {
                    const suitStrengths = {};
                    Object.keys(suits).forEach(suit => {
                        suitStrengths[suit] = evaluateHandStrength(suit);
                    });
                    
                    const bestSuit = Object.keys(suitStrengths).reduce((a, b) =>
                        suitStrengths[a] > suitStrengths[b] ? a : b,
                    );
                    setTrump(bestSuit, "bot");
                }, 600);
            }

            function setTrump(suit, caller) {
                trumpSuit = suit;
                trumpCaller = caller;
                trumpSuitEl.textContent = suits[trumpSuit];
                trumpSuitEl.className = `text-2xl sm:text-3xl font-bold ${suitColors[trumpSuit]}`;
                showMessage(
                    "Trump Chosen!",
                    `The trump suit is ${suits[trumpSuit]}. Let the game begin!`,
                    [
                        {
                            text: "Start Playing",
                            class: "trump-btn bg-green-700 hover:bg-green-600 text-white",
                            callback: startHandPlay,
                        },
                    ],
                );
            }

            function startHandPlay() {
                currentTurn = isPlayerDealer ? "bot" : "player";
                trickWinner = "";
                if (currentTurn === "player") updatePlayableCards();
                else setTimeout(botPlayCard, 800);
            }

            function nextTurn() {
                currentTurn = trickWinner;
                if (currentTurn === "player") updatePlayableCards();
                else setTimeout(botPlayCard, 800);
            }

            function getEffectiveSuit(card) {
                if (!card || !trumpSuit) return card ? card.suit : null;
                const leftBowerSuit = sameColorSuits[trumpSuit];
                if (card.rank === "J" && card.suit === leftBowerSuit) {
                    return trumpSuit;
                }
                return card.suit;
            }

            function getCardValue(card) {
                if (!card) return 0;
                const effectiveSuit = getEffectiveSuit(card);
                const rankValue = ranks.indexOf(card.rank);

                if (effectiveSuit === trumpSuit) {
                    if (card.rank === "J" && card.suit === trumpSuit) return 20;
                    if (card.rank === "J" && card.suit !== trumpSuit) return 19;
                    return 10 + rankValue;
                }
                return rankValue;
            }

            function updatePlayableCards() {
                document
                    .querySelectorAll(".card")
                    .forEach((c) => c.classList.remove("playable"));
                if (currentTurn !== "player") return;

                const playableCards = getPlayerPlayableCards();
                playableCards.forEach((cardInfo) => {
                    const el = document.getElementById(cardInfo.id);
                    if (el) {
                        el.classList.add("playable");
                        el.onclick = () => playerPlayCard(cardInfo);
                    }
                });
            }

            function getPlayerPlayableCards() {
                const allPlayerCards = [
                    ...playerHand.inHand.map((c, i) => ({
                        card: c,
                        id: `player-inhand-${i}`,
                        source: "inHand",
                        index: i,
                    })),
                    ...playerHand.tableFaceUp.map((c, i) => ({
                        card: c,
                        id: `player-fu-${i}`,
                        source: "tableFaceUp",
                        index: i,
                    })),
                ].filter((item) => item.card);

                if (!leadCard) return allPlayerCards;

                const effectiveLeadSuit = getEffectiveSuit(leadCard);
                const cardsInLeadSuit = allPlayerCards.filter(
                    (item) => getEffectiveSuit(item.card) === effectiveLeadSuit,
                );

                return cardsInLeadSuit.length > 0
                    ? cardsInLeadSuit
                    : allPlayerCards;
            }

            function playerPlayCard(cardInfo) {
                if (currentTurn !== "player" || handOver) return;

                let playedCard;

                if (cardInfo.source === "inHand") {
                    playedCard = playerHand.inHand.splice(
                        cardInfo.index,
                        1,
                        null,
                    )[0];
                } else {
                    playedCard = playerHand.tableFaceUp.splice(
                        cardInfo.index,
                        1,
                        null,
                    )[0];
                }

                renderHands();

                playerTrickCardEl.innerHTML =
                    createCardElement(playedCard).innerHTML;
                playerTrickCardEl.className =
                    createCardElement(playedCard).className;
                playerTrickCardEl.classList.remove("hidden", "playable");
                playerTrickCardEl.classList.add("trick-card-enter");

                trickCards.push({ player: "player", card: playedCard });

                if (!leadCard) {
                    leadCard = playedCard;
                    currentTurn = "bot";
                    updatePlayableCards();
                    setTimeout(botPlayCard, 800);
                } else {
                    currentTurn = "";
                    updatePlayableCards();
                    setTimeout(evaluateTrick, 1000);
                }
            }

            function getStrategicCardChoice(allBotCards, isLeading) {
                const effectiveLeadSuit = leadCard ? getEffectiveSuit(leadCard) : null;
                const cardsInLeadSuit = effectiveLeadSuit ? 
                    allBotCards.filter(item => getEffectiveSuit(item.card) === effectiveLeadSuit) : [];
                const trumpCards = allBotCards.filter(item => getEffectiveSuit(item.card) === trumpSuit);
                
                // Adjust strategy based on difficulty
                if (botDifficulty === "easy") {
                    // Easy mode: more random, less optimal
                    if (Math.random() < 0.3) {
                        return allBotCards[Math.floor(Math.random() * allBotCards.length)];
                    }
                } else if (botDifficulty === "hard") {
                    // Hard mode: perfect information about remaining cards
                    // Count cards that have been played
                    const playedCards = trickCards.map(tc => tc.card);
                    const remainingCards = deck.filter(c => !playedCards.some(pc => pc.rank === c.rank && pc.suit === c.suit));
                }
                
                if (isLeading) {
                    // Leading strategy: consider game state
                    const tricksRemaining = 12 - (playerTricks + botTricks);
                    const isWinning = botTricks > playerTricks;
                    
                    if (botDifficulty === "easy") {
                        // Simple strategy for easy mode
                        return allBotCards.sort((a, b) => getCardValue(b.card) - getCardValue(a.card))[0];
                    }
                    
                    if (isWinning && tricksRemaining <= 4) {
                        // Play conservatively when ahead
                        return allBotCards.sort((a, b) => getCardValue(a.card) - getCardValue(b.card))[0];
                    } else if (!isWinning && tricksRemaining <= 4) {
                        // Play aggressively when behind
                        return allBotCards.sort((a, b) => getCardValue(b.card) - getCardValue(a.card))[0];
                    } else {
                        // Mid-game: lead with strong but not best cards
                        const nonTrumpCards = allBotCards.filter(item => getEffectiveSuit(item.card) !== trumpSuit);
                        if (nonTrumpCards.length > 0) {
                            return nonTrumpCards.sort((a, b) => getCardValue(b.card) - getCardValue(a.card))[0];
                        }
                        return allBotCards.sort((a, b) => getCardValue(b.card) - getCardValue(a.card))[0];
                    }
                } else {
                    // Following strategy
                    if (cardsInLeadSuit.length > 0) {
                        // Must follow suit
                        const leadCardValue = getCardValue(leadCard);
                        const higherCards = cardsInLeadSuit.filter(item => getCardValue(item.card) > leadCardValue);
                        
                        if (higherCards.length > 0) {
                            // Play lowest card that can win
                            return higherCards.sort((a, b) => getCardValue(a.card) - getCardValue(b.card))[0];
                        } else {
                            // Can't win, play lowest
                            return cardsInLeadSuit.sort((a, b) => getCardValue(a.card) - getCardValue(b.card))[0];
                        }
                    } else {
                        // Can't follow suit
                        if (trumpCards.length > 0) {
                            // Have trump - consider if worth using
                            const opponentMayHaveTrump = playerTricks < 7;
                            if (opponentMayHaveTrump || getCardValue(leadCard) >= 15) {
                                // Play lowest trump
                                return trumpCards.sort((a, b) => getCardValue(a.card) - getCardValue(b.card))[0];
                            }
                        }
                        // Dump lowest card
                        return allBotCards.sort((a, b) => getCardValue(a.card) - getCardValue(b.card))[0];
                    }
                }
            }

            function botPlayCard() {
                if (currentTurn !== "bot" || handOver) return;

                setTimeout(() => {
                    const allBotCards = getBotPlayableCards();
                    const cardToPlayInfo = getStrategicCardChoice(allBotCards, !leadCard);

                    let playedCard;
                    if (cardToPlayInfo.source === "inHand") {
                        playedCard = botHand.inHand.splice(
                            cardToPlayInfo.index,
                            1,
                            null,
                        )[0];
                    } else {
                        playedCard = botHand.tableFaceUp.splice(
                            cardToPlayInfo.index,
                            1,
                            null,
                        )[0];
                    }

                    botTrickCardEl.innerHTML =
                        createCardElement(playedCard).innerHTML;
                    botTrickCardEl.className = `card ${suitColors[playedCard.suit]}`;
                    botTrickCardEl.classList.remove("hidden");
                    botTrickCardEl.classList.add("trick-card-enter");

                    trickCards.push({ player: "bot", card: playedCard });

                    if (!leadCard) {
                        leadCard = playedCard;
                        currentTurn = "player";
                        renderHands();
                    } else {
                        currentTurn = "";
                        renderHands();
                        setTimeout(evaluateTrick, 600);
                    }
                }, 600);
            }

            function getBotPlayableCards() {
                return [
                    ...botHand.inHand.map((c, i) => ({
                        card: c,
                        source: "inHand",
                        index: i,
                    })),
                    ...botHand.tableFaceUp.map((c, i) => ({
                        card: c,
                        id: `bot-fu-${i}`,
                        source: "tableFaceUp",
                        index: i,
                    })),
                ].filter((item) => item.card);
            }

            function evaluateTrick() {
                if (trickCards.length < 2) return;

                const leadInfo = trickCards.find(
                    (info) => info.card === leadCard,
                );
                const followInfo = trickCards.find(
                    (info) => info.card !== leadCard,
                );

                if (!leadInfo || !followInfo) {
                    clearTrick();
                    return;
                }

                const leadCardData = leadInfo.card;
                const followCardData = followInfo.card;
                const effectiveLeadSuit = getEffectiveSuit(leadCardData);
                const effectiveFollowSuit = getEffectiveSuit(followCardData);
                let winnerInfo;

                if (effectiveFollowSuit === trumpSuit) {
                    winnerInfo =
                        effectiveLeadSuit === trumpSuit &&
                        getCardValue(leadCardData) >
                            getCardValue(followCardData)
                            ? leadInfo
                            : followInfo;
                } else if (effectiveLeadSuit === trumpSuit) {
                    winnerInfo = leadInfo;
                } else if (effectiveFollowSuit === effectiveLeadSuit) {
                    winnerInfo =
                        getCardValue(followCardData) >
                        getCardValue(leadCardData)
                            ? followInfo
                            : leadInfo;
                } else {
                    winnerInfo = leadInfo;
                }

                trickWinner = winnerInfo.player;

                if (trickWinner === "player") playerTricks++;
                else botTricks++;

                playerTrickCountEl.textContent = playerTricks;
                botTrickCountEl.textContent = botTricks;

                const animationClass =
                    trickWinner === "player" ? "fly-off-player" : "fly-off-bot";
                playerTrickCardEl.classList.add(animationClass);
                botTrickCardEl.classList.add(animationClass);

                setTimeout(clearTrick, 800);
            }

            function clearTrick() {
                playerTrickCardEl.classList.add("hidden");
                botTrickCardEl.classList.add("hidden");
                playerTrickCardEl.className = "card hidden";
                botTrickCardEl.className = "card hidden";
                leadCard = null;
                trickCards = [];

                flipExposedCards();
            }

            function flipExposedCards() {
                let cardsFlipped = false;
                for (let i = 0; i < 4; i++) {
                    if (
                        playerHand.tableFaceUp[i] === null &&
                        playerHand.tableFaceDown[i] !== null
                    ) {
                        playerHand.tableFaceUp[i] = playerHand.tableFaceDown[i];
                        playerHand.tableFaceDown[i] = null;
                        cardsFlipped = true;
                    }
                    if (
                        botHand.tableFaceUp[i] === null &&
                        botHand.tableFaceDown[i] !== null
                    ) {
                        botHand.tableFaceUp[i] = botHand.tableFaceDown[i];
                        botHand.tableFaceDown[i] = null;
                        cardsFlipped = true;
                    }
                }
                renderHands();

                if (playerTricks + botTricks === 12) {
                    setTimeout(endHand, 500);
                } else {
                    setTimeout(nextTurn, 150);
                }
            }

            function endHand() {
                handOver = true;
                let winnerText = "";

                if (trumpCaller === "player") {
                    if (playerTricks >= 7) {
                        playerScore += playerTricks;
                        botScore += botTricks;
                        winnerText = `You made trump! You get ${playerTricks} points.`;
                    } else {
                        botScore += 12;
                        winnerText = `You failed to make trump! Bot gets 12 points.`;
                    }
                } else {
                    if (botTricks >= 7) {
                        botScore += botTricks;
                        playerScore += playerTricks;
                        winnerText = `Bot made trump! Bot gets ${botTricks} points.`;
                    } else {
                        playerScore += 12;
                        winnerText = `Bot failed to make trump! You get 12 points.`;
                    }
                }
                playerScoreEl.textContent = playerScore;
                botScoreEl.textContent = botScore;

                if (playerScore >= 31 || botScore >= 31) {
                    const finalWinner =
                        playerScore >= botScore ? "Player" : "Bot";
                showMessage(
                    "Hand Over",
                    winnerText,
                    [
                        {
                            text: "Next Hand",
                            class: "trump-btn bg-blue-700 hover:bg-blue-600 text-white",
                            callback: startNewHand,
                        },
                    ],
                );
                } else {
                    showMessage("Hand Over", winnerText, [
                        {
                            text: "Next Hand",
                            class: "trump-btn bg-cyan-600",
                            callback: startNewHand,
                        },
                    ]);
                }
            }

            function startNewHand() {
                handOver = false;
                playerTricks = 0;
                botTricks = 0;
                playerTrickCountEl.textContent = "0";
                botTrickCountEl.textContent = "0";
                trumpSuitEl.textContent = "-";
                trumpSuitEl.className = "text-2xl sm:text-3xl font-bold";
                isPlayerDealer = !isPlayerDealer;
                createDeck();
                shuffleDeck();
                dealCards();
                renderHands();
                beginTrumpSelection();
            }

            function resetGame() {
                playerScore = 0;
                botScore = 0;
                playerScoreEl.textContent = "0";
                botScoreEl.textContent = "0";
                isPlayerDealer = false;
                startNewHand();
            }

            window.onload = () => {
                showMessage(
                    "Welcome to Euchre!",
                    "A two-handed variation. Get ready to play.",
                    [
                        {
                            text: "Start Game",
                            class: "trump-btn bg-green-700 hover:bg-green-600 text-white",
                            callback: resetGame,
                        },
                    ],
                );
                rulesBtn.addEventListener("click", showRules);
                difficultySelect.addEventListener("change", (e) => {
                    botDifficulty = e.target.value;
                });
            };
        </script>
    </body>
</html>
